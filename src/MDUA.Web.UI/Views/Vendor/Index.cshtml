@using MDUA.Entities
@model List<Vendor>

@{
    ViewData["Title"] = "Vendors List";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

@section Styles {
    <link href="~/css/vendor.css" rel="stylesheet" />
}

<div class="container-fluid h-100">
    
    <div class="d-flex justify-content-between align-items-center mb-4 sticky-page-header">
        <div>
            <h4 class="mb-1 fw-bold text-dark">Vendor Management</h4>
            <p class="text-muted small mb-0">Manage your suppliers and partners</p>
        </div>
        <a href="/Vendor/Add" class="btn btn-primary rounded-pill shadow-sm px-4">
            <i class="fas fa-plus me-2"></i> Add Vendor   
        </a>
    </div>

    <div class="glass-card p-0">
        <div class="table-responsive table-wrapper">
            <table class="table table-hover mb-0 products-table">
                <thead>
                    <tr>
                        <th class="ps-4">Vendor Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th class="text-end pe-4">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model != null && Model.Any())
                    {
                        foreach (var item in Model)
                        {
                            <tr id="parent-row-@item.Id">
                                <td class="ps-4 fw-bold text-dark">@item.VendorName</td>
                                <td class="text-muted">@item.Email</td>
                                <td>
                                    @if(!string.IsNullOrEmpty(item.Phone))
                                    {
                                        <span class="pill-tag"><i class="fas fa-phone me-1"></i> @item.Phone</span>
                                    }
                                    else 
                                    { 
                                        <span>-</span> 
                                    }
                                </td>
                                <td class="text-end pe-4">
                                    <form action="/Vendor/History" method="post" class="d-inline">
                                        <input type="hidden" name="id" value="@item.Id" />
                                        <button type="submit" class="btn btn-sm btn-light border text-info me-1" title="View History">
                                            <i class="fas fa-history"></i> History
                                        </button>
                                    </form>                                    <a href="/Vendor/Add?id=@item.Id" class="btn btn-sm btn-light border text-primary me-1" title="Edit">
                                        <i class="fas fa-edit"></i>
                                    </a>

                                    <button onclick="deleteVendor(@item.Id)" class="btn btn-sm btn-light border text-danger" title="Delete">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="4" class="text-center py-5 text-muted">
                                <i class="fas fa-box-open fa-3x mb-3 opacity-25"></i>
                                <p>No vendors found.</p>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Only Delete function remains
        function deleteVendor(id) {
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#dc3545',
                cancelButtonColor: '#6c757d',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.post('/Vendor/Delete', { id: id }, function(response) {
                        if (response.success) {
                            Swal.fire('Deleted!', response.message, 'success')
                            .then(() => location.reload());
                        } else {
                            Swal.fire('Error!', 'Something went wrong.', 'error');
                        }
                    });
                }
            })
        }
    </script>
}