@model List<MDUA.Entities.ProductCategory>

@{
    ViewBag.Title = "Product Categories";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

@section Styles {
    <style>
        /* Modern "Soft" Badges */
        .badge-soft-primary {
            background-color: #e3f2fd;
            color: #1976d2;
        }

        .badge-soft-success {
            background-color: #e8f5e9;
            color: #388e3c;
        }

        .badge-soft-danger {
            background-color: #ffebee;
            color: #c62828;
        }

        .badge-pill {
            padding-right: 0.8em;
            padding-left: 0.8em;
        }

        /* Card & Table Polish */
        .card-custom {
            border: none;
            box-shadow: 0 0 15px rgba(0,0,0,0.05);
            border-radius: 8px;
        }

        .table-custom th {
            border-top: none;
            background-color: #f8f9fa;
            color: #6c757d;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }

        .table-custom td {
            vertical-align: middle;
            padding: 1rem 0.75rem;
            border-color: #f1f3f5;
        }

        .table-hover tbody tr:hover {
            background-color: #fafafa;
        }

        /* Action Button */
        .btn-icon {
            width: 32px;
            height: 32px;
            padding: 0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        /* Switch Label Polish */
        .custom-control-label {
            cursor: pointer;
            user-select: none;
            font-size: 0.9rem;
        }
    </style>
}

<div class="container-fluid mt-4">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="h4 mb-0 text-gray-800">Product Categories</h2>
            <p class="text-muted small mb-0">Manage your product classifications and visibility.</p>
        </div>
        <button class="btn btn-primary shadow-sm" onclick="openModal(0)">
            <i class="fa fa-plus-circle mr-1"></i> Create Category
        </button>
    </div>

    @if (ViewBag.Error != null)
    {
        <div class="alert alert-danger shadow-sm border-0 border-left-danger fade show" role="alert">
            <i class="fa fa-exclamation-triangle mr-2"></i> @ViewBag.Error
        </div>
    }

    <div class="card card-custom bg-white">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover table-custom mb-0">
                    <thead>
                        <tr>
                            <th class="pl-4">Category Name</th>
                            <th>Source</th>
                            <th>Visibility Status</th>
                            <th class="text-right pr-4">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model == null || !Model.Any())
                        {
                            <tr>
                                <td colspan="4" class="text-center py-5 text-muted">
                                    <i class="fa fa-folder-open-o fa-3x mb-3 text-gray-300"></i>
                                    <p class="mb-0">No categories found.</p>
                                </td>
                            </tr>
                        }
                        else
                        {
                            foreach (var item in Model)
                            {
                                bool isGlobal = item.CompanyId == null || item.CompanyId == 0;

                                <tr>
                                    <td class="pl-4">
                                        <div class="d-flex align-items-center">
                                            <div class="mr-3">
                                                @if (isGlobal)
                                                {
                                                    <span class="text-primary"><i class="fa fa-globe fa-lg"></i></span>
                                                }
                                                else
                                                {
                                                    <span class="text-success"><i class="fa fa-folder fa-lg"></i></span>
                                                }
                                            </div>
                                            <div>
                                                <div class="font-weight-bold text-dark">@item.Name</div>
                                                <small class="text-muted">ID: #@item.Id</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        @if (isGlobal)
                                        {
                                            <span class="badge badge-pill badge-soft-primary">Global / System</span>
                                        }
                                        else
                                        {
                                            <span class="badge badge-pill badge-soft-success">Private / Custom</span>
                                        }
                                    </td>
                                    <td>
                                        <div class="custom-control custom-switch">
                                            <input type="checkbox"
                                                   class="custom-control-input"
                                                   id="switch_@item.Id"
                                                   @(item.IsActive ? "checked" : "")
                                                   onchange="toggleStatus(@item.Id, this)">
                                            <label class="custom-control-label" for="switch_@item.Id">
                                                <span class="@(item.IsActive ? "text-success" : "text-muted")" id="lbl_@item.Id">
                                                    @(item.IsActive ? "Active" : "Inactive")
                                                </span>
                                            </label>
                                        </div>
                                    </td>
                                    <td class="text-right pr-4">
                                        <button class="btn btn-icon btn-outline-secondary"
                                                title="Edit Category"
                                                onclick="openModal(@item.Id)">
                                            <i class="fa fa-pencil"></i>
                                        </button>
                                    </td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="categoryModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content border-0 shadow-lg" id="modalContent">
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/product-category.js" asp-append-version="true"></script>
    <script>
        // Optional: Update the text label dynamically when toggling
        function toggleStatus(id, checkbox) {
            // Call your original function
            window.toggleStatus(id, checkbox);

            // Visual feedback
            var label = $("#lbl_" + id);
            if(checkbox.checked) {
                label.text("Active").removeClass("text-muted").addClass("text-success");
            } else {
                label.text("Inactive").removeClass("text-success").addClass("text-muted");
            }
        }
    </script>
}